{
  "AWSTemplateFormatVersion" : "2010-09-09",

  "Description" : "dzarquitectura project template",

  "Resources" : {
    "MainVpc" : {
      "Type" : "AWS::EC2::VPC",
      "Properties" : {
        "CidrBlock" : "10.0.0.0/16",
        "EnableDnsSupport" : "true",
        "EnableDnsHostnames" : "false",
        "InstanceTenancy" : "default",
        "Tags" : [ {"Key" : "Name", "Value" : "MainVpc"},
				   {"Key" : "Project", "Value" : "dzarq"},
                   {"Key" : "Ceco", "Value" : "dzImprovements"}		]
  		   }
  	},
	"TheRT" : {
	   "Type" : "AWS::EC2::RouteTable",
	   "Properties" : {
		  "VpcId" : { "Ref": "MainVpc" },
		  "Tags" : [ {"Key" : "Name", "Value" : "TheRT"},
			  	     {"Key" : "Project", "Value" : "dzarq"},
				     {"Key" : "Ceco", "Value" : "dzImprovements"}		]
	   }
	},
	"RouteForRT" :{
		  "Type" : "AWS::EC2::Route",
		  "DependsOn": "TheIGW",
		  "Properties" : {
			"DestinationCidrBlock" : "0.0.0.0/0",
			"GatewayId" : { "Ref": "TheIGW" },
			"RouteTableId" : { "Ref": "TheRT" }
		  }
	},
    "TheIGW" : {
      "Type" : "AWS::EC2::InternetGateway",
      "Properties" : {
        "Tags" : [ {"Key" : "Name", "Value" : "TheIGW"},
				   {"Key" : "Project", "Value" : "dzarq"},
                   {"Key" : "Ceco", "Value" : "dzImprovements"}		]
      }
    },
	"VpcToIgwAttachement":{
		"Type" : "AWS::EC2::VPCGatewayAttachment",
		"Properties" : {
		  "InternetGatewayId" : { "Ref": "TheIGW" },
		  "VpcId" : { "Ref": "MainVpc" }
		}	
	},
	"SubnetA" : {
		  "Type" : "AWS::EC2::Subnet",
		  "Properties" : {
			"AvailabilityZone" : "eu-west-1a",
			"CidrBlock" : "10.0.0.0/24",
			"MapPublicIpOnLaunch" : "false",
			"VpcId" : { "Ref": "MainVpc" },
			"Tags" : [ {"Key" : "Name", "Value" : "SubnetA"},
					   {"Key" : "Project", "Value" : "dzarq"},
					   {"Key" : "Ceco", "Value" : "dzImprovements"}		]			
		  }
	},
	"SubnetB" : {
		  "Type" : "AWS::EC2::Subnet",
		  "Properties" : {
			"AvailabilityZone" : "eu-west-1b",
			"CidrBlock" : "10.0.1.0/24",
			"MapPublicIpOnLaunch" : "false",
			"VpcId" : { "Ref": "MainVpc" },
			"Tags" : [ {"Key" : "Name", "Value" : "SubnetB"},
					   {"Key" : "Project", "Value" : "dzarq"},
					   {"Key" : "Ceco", "Value" : "dzImprovements"}		]			
		  }
	},
	"SubnetC" : {
		  "Type" : "AWS::EC2::Subnet",
		  "Properties" : {
			"AvailabilityZone" : "eu-west-1c",
			"CidrBlock" : "10.0.2.0/24",
			"MapPublicIpOnLaunch" : "false",
			"VpcId" : { "Ref": "MainVpc" },
			"Tags" : [ {"Key" : "Name", "Value" : "SubnetC"},
					   {"Key" : "Project", "Value" : "dzarq"},
					   {"Key" : "Ceco", "Value" : "dzImprovements"}		]
		  }
	},
	"SubnetARouteTableRelation" : {
		"Type" : "AWS::EC2::SubnetRouteTableAssociation",
		"Properties" : {
			"RouteTableId" : { "Ref": "TheRT" },
			"SubnetId" : { "Ref": "SubnetA" }
		}
	},
	"SubnetBRouteTableRelation" : {
		"Type" : "AWS::EC2::SubnetRouteTableAssociation",
		"Properties" : {
			"RouteTableId" : { "Ref": "TheRT" },
			"SubnetId" : { "Ref": "SubnetB" }
		}
	},
	"SubnetCRouteTableRelation" : {
		"Type" : "AWS::EC2::SubnetRouteTableAssociation",
		"Properties" : {
			"RouteTableId" : { "Ref": "TheRT" },
			"SubnetId" : { "Ref": "SubnetC" }
		}
	},
	"WebServeSG":{
		"Type" : "AWS::EC2::SecurityGroup",
		"Properties" : {
			"GroupName" : "WebServeSG",
			"GroupDescription" : "SG for web Servers. HTTP+S & SSH",
			"VpcId" : { "Ref": "MainVpc" },						
			"SecurityGroupIngress" : [
				{
					"IpProtocol" : "tcp",
					"FromPort" : "22",
					"ToPort" : "22",
					"CidrIp" : "0.0.0.0/0"
				},
				{
					"IpProtocol" : "tcp",
					"FromPort" : "443",
					"ToPort" : "443",
					"CidrIp" : "0.0.0.0/0"
				},			
				{
					"IpProtocol" : "tcp",
					"FromPort" : "80",
					"ToPort" : "80",
					"CidrIp" : "0.0.0.0/0"
				}
			],			
			"SecurityGroupEgress" : [ 
				{
					"IpProtocol" : "-1",
					"CidrIp" : "0.0.0.0/0"
				}			
			],
			"Tags" : [ {"Key" : "Name", "Value" : "WebServeSG"},
					   {"Key" : "Project", "Value" : "dzarq"},
					   {"Key" : "Ceco", "Value" : "dzImprovements"}]
		}	
	}
	
  },

  "Outputs" : {
	  "VpcName" : {
		"Description" : "Vpc Name",
		"Value" : { "Ref" : "MainVpc" }
		}
	  }  
}